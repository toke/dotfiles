#!/bin/sh
###############################################################
# menu_do - a meta tool for launching scripts in sway/i3
#
#
# Usuallly symlinked to create a new type of workflow.
###############################################################

set -e

config_dir="$HOME/.config"
menu_cmd="bemenu"

script_name=$(basename $0)
config_name=$(echo $script_name | tr -dc '[:alnum:]_')
prompt=${config_name^}

[ ! -f "$config_dir/$config_name" ] && \
    echo "Missing config: $config_name" && exit 1

choice=$(
    grep -v "#" "$config_dir/$config_name" | sort | \
        sed -r 's/"\<([^"]+)"/\1/g' | \
        awk -F: '{ st = index($0,":");printf "%s\t→\t%s\n", $1, substr($0,st+1)}' | \
    ${menu_cmd} -l 10 --fn 'Droid Sans Mono-9' -p "$prompt> " 
)

if [ $? = "0" ] ; then
   echo $choice |
       sh -c "$(awk  -F'→'  '{ print $2 }')"&
fi
